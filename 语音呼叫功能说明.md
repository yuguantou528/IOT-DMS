# 语音呼叫功能实现说明

## 功能概述

为可视化监控大屏的"监控设备"标签页中的执法仪类型设备添加了语音呼叫功能，用户可以点击语音呼叫按钮对执法记录仪发起点呼操作。

## 实现的功能

### 1. 音频调度服务 (`src/services/audioDispatchService.js`)
- **发起单呼**: `initiateCall(targetDeviceId, callType)`
- **接听呼叫**: `answerCall(callId)`
- **结束呼叫**: `endCall(callId)`
- **获取通话记录**: `getCallRecords(params)`
- **获取设备音频状态**: `getDeviceAudioStatus(deviceId)`

### 2. 语音呼叫弹窗组件 (`src/components/AudioCallModal/`)
- **设备信息展示**: 显示设备名称、在线状态、信号强度
- **呼叫状态管理**: 支持呼叫中、通话中、已结束等状态
- **通话控制**: 发起呼叫、静音/取消静音、结束通话
- **通话时长统计**: 实时显示通话时长
- **动画效果**: 呼叫和通话状态的视觉反馈

### 3. 监控面板集成
- **StandaloneMonitor**: 独立监控页面集成语音呼叫功能
- **FullScreenMonitor**: 全屏监控页面集成语音呼叫功能
- **设备类型识别**: 仅对执法仪类型(`body_camera`)设备显示语音呼叫按钮
- **状态检查**: 只有在线设备才能发起呼叫

## 使用方法

### 1. 在监控面板中使用
1. 打开可视化监控大屏
2. 在"监控设备"标签页中找到执法仪类型的设备
3. 点击设备操作区域的电话图标按钮
4. 在弹出的语音呼叫窗口中点击绿色呼叫按钮
5. 等待对方接听，进入通话状态
6. 通话结束后点击红色结束按钮

### 2. 呼叫流程
```
发起呼叫 → 呼叫中(等待接听) → 通话中 → 结束通话
```

### 3. 功能特性
- **设备状态检查**: 自动检查设备是否在线
- **信号强度显示**: 实时显示设备信号强度
- **通话时长统计**: 精确到秒的通话时长记录
- **静音功能**: 支持通话过程中的静音操作
- **状态反馈**: 清晰的视觉和文字状态提示

## 技术实现

### 1. 数据流
```
用户点击 → handleAudioCall → AudioCallModal → initiateCall → 模拟呼叫成功 → 状态更新
```

### 2. 状态管理
- **callStatus**: idle(空闲) | calling(呼叫中) | talking(通话中) | ended(已结束)
- **audioStatus**: idle(空闲) | calling(呼叫中) | talking(通话中) | busy(忙线) | offline(离线)

### 3. 模拟数据
- 为了演示目的，系统使用模拟数据和模拟的呼叫成功逻辑
- 支持多种设备ID匹配方式，确保兼容性
- 自动模拟对方接听过程(3-5秒后自动接通)

## 文件结构

```
src/
├── services/
│   └── audioDispatchService.js          # 音频调度服务
├── components/
│   └── AudioCallModal/
│       ├── index.js                     # 语音呼叫弹窗组件
│       ├── index.module.css             # 样式文件
│       └── test.js                      # 测试组件
└── pages/
    └── VisualMonitor/
        ├── StandaloneMonitor.js         # 独立监控页面(已集成)
        └── FullScreenMonitor.js         # 全屏监控页面(已集成)
```

## 扩展功能

### 未来可扩展的功能
1. **组呼功能**: 支持对多个设备同时发起呼叫
2. **录音功能**: 通话过程录音和回放
3. **通话历史**: 详细的通话记录查询
4. **设备分组**: 按组织结构进行设备分组管理
5. **权限控制**: 不同用户的呼叫权限管理
6. **实时音频**: 集成真实的音频通信协议

### 配置选项
- 呼叫超时时间
- 自动接听设置
- 音频质量配置
- 信号强度阈值

## 注意事项

1. 当前实现为前端模拟版本，实际部署时需要集成真实的音频通信服务
2. 设备ID匹配逻辑已优化，支持多种ID格式
3. 所有呼叫操作都有相应的状态反馈和错误处理
4. 组件设计遵循响应式原则，支持不同屏幕尺寸
